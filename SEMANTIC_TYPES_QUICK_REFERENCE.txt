================================================================================
YARNNN SEMANTIC TYPES - QUICK REFERENCE GUIDE
================================================================================

COMPLETE SEMANTIC TYPE CATALOG (18 TYPES)
================================================================================

KNOWLEDGE BLOCKS (8) - Concrete extracted information
  1. fact           ExtractedFact (generic)       Inferred    confidence
  2. metric         ExtractedFact("metric")       Inferred    confidence  
  3. event          ExtractedFact("event")        Inferred    confidence
  4. insight        ExtractedInsight              "insight"   confidence
  5. action         ExtractedAction               "solution"  0.8 fixed
  6. finding        ExtractedFact (default)       Inferred    confidence
  7. quote          ExtractedFact("quote")        Inferred    confidence
  8. summary        FocusedExtraction.summary     None        extraction_conf

MEANING BLOCKS (7) - Purpose, structure, constraints
  9. intent         (semantic annotation)         N/A         N/A
 10. objective      (semantic annotation)         N/A         N/A
 11. rationale      (semantic annotation)         N/A         N/A
 12. principle      (semantic annotation)         N/A         N/A
 13. assumption     (semantic annotation)         N/A         N/A
 14. context        (semantic annotation)         N/A         N/A
 15. constraint     Inferred from content         None        confidence

STRUCTURAL BLOCKS (3) - Metadata and anchoring
 16. entity         ExtractedContext              None        0.7 fixed
 17. classification FocusedExtraction.type        None        extraction_conf
 18. reference      (future)                      N/A         N/A

================================================================================
WHERE SEMANTIC TYPES ARE ASSIGNED (P0-P4)
================================================================================

P0 CAPTURE
  └─ No semantic types assigned (raw input)

P1 SUBSTRATE (ImprovedP1SubstrateAgent)
  └─ _transform_to_substrate() method (lines 426-722)
  └─ ALL semantic types assigned here
  └─ File: improved_substrate_agent.py

P2 GRAPH (RelationshipInference)
  └─ Uses semantic_type for relationship filtering
  └─ Relationship types: addresses, supports, contradicts, depends_on

P3 REFLECTION
  └─ Uses semantic_type for context filtering
  └─ Filter types: insight, objective, constraint

P4 COMPOSITION
  └─ Uses semantic_type for block categorization
  └─ Filter types: objective, insight, principle, constraint

================================================================================
FACT-TYPE MAPPING TABLE
================================================================================

ExtractedFact.type → semantic_type
  "metric"         → metric
  "event"          → event
  "status"         → status
  "quote"          → quote
  "finding"        → finding
  "feature"        → finding (mapped)
  "feature perf"   → finding (mapped)
  "technical"      → finding (mapped)
  "pricing"        → finding (mapped)
  (default)        → finding
  (if constraint)  → constraint (overridden)

================================================================================
RELATIONSHIP ONTOLOGY (P2 GRAPH)
================================================================================

"addresses"  (Solution → Problem)
  From: action, insight, objective, solution, finding, decision
  To:   problem, constraint, issue, challenge, risk, gap

"supports"   (Evidence → Claim)
  From: fact, finding, metric, evidence, quote, data, observation
  To:   objective, insight, hypothesis, principle, decision, conclusion

"contradicts"  (Conflict)
  From: fact, finding, insight, observation, metric, evidence
  To:   assumption, fact, insight, principle, hypothesis, conclusion

"depends_on"   (Prerequisite)
  From: action, objective, task, milestone, feature, decision
  To:   action, objective, constraint, principle, prerequisite, capability

================================================================================
ANCHOR ROLE INFERENCE
================================================================================

Content Pattern            → anchor_role    confidence
  "bug", "issue", "fail"   → problem        +0.1 to confidence
  "%", "$", "#" in text    → metric         confidence
  "user", "customer"       → customer       confidence
  "feature", "capability"  → feature        confidence
  "require", "must"        → constraint     confidence
  "goal", "aspire"         → vision         confidence

Default for insights:      "insight"        (insight.confidence)
Default for high-priority actions: "solution" (0.85)

================================================================================
CONFIDENCE THRESHOLDS
================================================================================

Duplicate Detection (P1)
  HIGH_CONFIDENCE (0.85)    → Auto-propose MERGE
  MEDIUM_CONFIDENCE (0.70)  → Propose UPDATE/ENRICH
  Below 0.70                → CREATE new

Relationship Inference (P2)
  HIGH_CONFIDENCE (0.90)    → Auto-accept
  MEDIUM_CONFIDENCE (0.70)  → Propose for review
  Below 0.70                → Reject

Default Confidences (P1)
  Extract.confidence        → Variable (0.0-1.0)
  Action blocks             → 0.8 (fixed)
  Entity blocks             → 0.7 (fixed)
  Summary blocks            → extraction_confidence

================================================================================
GOVERNANCE DEFAULTS
================================================================================

If semantic_type missing in governance_processor:
  Fallback order: block_data → metadata → fact_type → DEFAULT
  DEFAULT semantic_type: "insight"

This is the ONLY fallback in the pipeline.

================================================================================
PIPELINE DATA FLOW
================================================================================

raw_dumps (P0)
    ↓
FocusedExtraction (LLM extraction)
    ↓
_transform_to_substrate() (assign semantic_types)
    ↓
GovernanceDumpProcessor (validate + defaults)
    ↓
blocks table (all 18 types, state=ACCEPTED)
    ├─ P2 reads semantic_type for relationships
    ├─ P3 reads semantic_type for context filtering
    └─ P4 reads semantic_type for composition

================================================================================
QUICK DECISION TREE
================================================================================

Is this extracted information?
  ├─ Yes, it's a metric → type: "metric"
  ├─ Yes, it's an event → type: "event"  
  ├─ Yes, it's a quote → type: "quote"
  ├─ Yes, it's an insight → type: "insight"
  ├─ Yes, it's an action → type: "action"
  ├─ Yes, it's a finding → type: "finding"
  └─ Unclear → type: "insight" (FALLBACK)

Is this structural information?
  ├─ Yes, it's an entity → type: "entity"
  ├─ Yes, it's a classification → type: "classification"
  └─ Yes, it's a reference → type: "reference"

Is this semantic/intent information?
  ├─ Yes, it's an objective → type: "objective"
  ├─ Yes, it's a constraint → type: "constraint"
  ├─ Yes, it's an assumption → type: "assumption"
  └─ Other → type: "principle", "rationale", "context", "intent"

================================================================================
ADDING NEW SEMANTIC TYPES (CHECKLIST)
================================================================================

1. [ ] Choose category: Knowledge / Meaning / Structural
2. [ ] Add type name to categorization list (lines 101-109)
3. [ ] Update fact_type_map if derived from ExtractedFact
4. [ ] Add block creation logic in _transform_to_substrate()
5. [ ] Update RELATIONSHIP_ONTOLOGY if participates in relationships
6. [ ] Add to P3 filter configurations if needed
7. [ ] Add to P4 filter configurations if needed
8. [ ] Update semantic search example filters in docs
9. [ ] Test with duplicate detection (semantic primitives)

================================================================================
KEY FILES FOR SEMANTIC TYPES
================================================================================

Primary Implementation:
  improved_substrate_agent.py       Lines 426-722 (_transform_to_substrate)
  focused_extraction.py             Lines 1-268 (FocusedExtraction schema)
  semantic_primitives.py            Lines 418-493 (RELATIONSHIP_ONTOLOGY)

Governance:
  governance_processor.py           Lines 286-308 (CreateBlock with type)

P2 Relationships:
  semantic_primitives.py            Lines 566-680 (infer_relationships)

Documentation:
  SEMANTIC_LAYER_INTEGRATION_DESIGN.md (Architecture)
  SEMANTIC_TYPES_COMPREHENSIVE_ANALYSIS.md (This project)

================================================================================
CRITICAL INSIGHTS
================================================================================

1. SINGLE SOURCE OF TRUTH
   All semantic types assigned in P1's _transform_to_substrate() method
   Governance processor can override with DEFAULT "insight"

2. TYPE-AWARE RELATIONSHIPS
   P2 cannot create arbitrary relationships
   Relationship types constrained by semantic_type ontology
   E.g., "metric" cannot be from_type for "addresses" relationship

3. THREE-TIER CATEGORIZATION
   Knowledge blocks: Content, changeable, time-sensitive
   Meaning blocks: Structure, stable, guidance-oriented
   Structural blocks: Metadata, indexing, reference-oriented

4. CONFIDENCE IS CONTEXT-DEPENDENT
   fact.confidence = LLM extraction confidence
   action confidence = 0.8 fixed (reliable from extraction)
   entity confidence = 0.7 fixed (named entity extraction)

5. EMERGENT ANCHORS
   Anchors inferred from content patterns (not explicit semantic_type)
   Different from semantic_type categorization
   E.g., semantic_type="finding" but anchor_role="problem"

================================================================================

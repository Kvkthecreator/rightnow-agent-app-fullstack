# Canon v2.0 — Substrate/Artifact Model
Pure substrate memory layer with separate artifact expressions. Reflections are artifacts, not substrates.

# Yarnnn Memory Model — Canonical Substrate Contract (v2.0)

Aligned with Context OS substrate v1.2
Blocks (**context_blocks**) are structured units of meaning.
Last updated: 2025-07-25

---

## 1. Core Principle

The memory model captures, structures, and evolves cognitive inputs as **decoupled, composable substrates**.  
No substrate assumes the existence of another. All reference a shared `basket_id`.

---

## 2. Canonical Data Types

### Substrate Types (Pure Memory Layer)
| Type          | Description                          | Created When             |
| ------------- | ------------------------------------ | ------------------------ |
| `block`       | Structured knowledge ingredients     | Extracted by P1 agent    |
| `dump`        | Immutable unstructured input         | User submits dump        |
| `context_item`| Semantic connective tissue           | Created by P2 agent      |
| `timeline_event`| System activity audit log          | Emitted by system        |

### Artifact Types (Expression Layer)
| Type          | Description                          | Created When             |
| ------------- | ------------------------------------ | ------------------------ |
| `document`    | Versioned narrative compositions     | Composed by P4/user      |
| `reflection`  | Computed insights from substrate     | Generated by P3 agent    |

### Memory Plane (Substrate Only)
- **timeline_events**: Append-only memory stream of all substrate activity
- **substrate_relationships**: Links between substrate entities
- **Integration**: Pure substrate memory → computed artifacts → user interface

### Artifact Storage (Separate Layer)
- **documents**: Versioned compositions with git-like snapshots
- **reflections**: Computed insights targeting substrates OR document versions
- **document_versions**: Immutable snapshots for stable artifact references

Artifacts derive from substrate but exist independently. Documents can be freely edited; reflections can target substrate or document snapshots.

---

## 3. Substrate Lifecycle (Decoupled)

- Each substrate is explicitly created.  
- All reference the same `basket_id`.  
- No linear creation flow is enforced.

```mermaid
flowchart TD
    A([basket]) --> B1([raw_dump])
    A --> B2([block])
    A --> B3([document])
    A --> B4([context_item])

    B1 -->|agent interprets| B2
    B2 -->|composed in| B3
    B3 -->|tagged by| B4
    B2 -->|tagged by| B4
4. Memory Guarantees
Type	Mutability	Evolves	Source of Truth
raw_dump	Immutable	No	Yes (verbatim)
block	Revisable	Yes	Derived
document	Versioned	Yes	Composed
context_item	Governed	Yes	Derived (via proposals)
basket	Static ID	No	No
event	Immutable	No	Log only
5. Canonical Role Definitions
🧺 basket
Memory scope for all substrates.
Organizes raw_dumps, context_blocks, documents, context_items.
💭 raw_dump
Unstructured input, immutable.
May be referenced by context_blocks or documents.
⬛ block
Structured knowledge ingredient extracted from raw_dumps.
Contains semantic data (goals, constraints, metrics, entities) with transformation capabilities.
Agents extract these as data ingredients for document synthesis.
Lifecycle: PROPOSED → ACCEPTED → LOCKED → CONSTANT.
📄 document
Synthesized artifact generated from block ingredients + context_items + user intent.
P4 agent transforms ingredient data into coherent narratives.
Not a source of memory, but a generated expression of accumulated knowledge.
🏷️ context_item
Semantic connector (tags/themes).
May link to blocks, documents, baskets.
User-declared or agent-inferred.
Lifecycle: PROVISIONAL → PROPOSED → ACTIVE → [DEPRECATED | MERGED].
📜 event
Immutable audit entry.
Records creations, updates, proposals, rejections, and compositions.
6. Canonical Summary
All substrates are peers — no hierarchy.
Blocks (**context_blocks**) are structured knowledge ingredients with transformation capabilities.
Documents are synthesized artifacts, not manual compositions.
Narrative text is generated from ingredient data, not manually authored.
Events ensure full auditability and immutability.